%% \begin{figure*}[t]
\chapter{Каталог тестов для модели C/C++11}
\label{sec:litmusTests}

\newcommand{\litmusTestStart}[3]{
\begin{minipage}[t]{0.2\linewidth}
\textbf{#1} \\
Fully Supported: #2 \\
Requires: #3\\
\end{minipage}
}
\newcommand{\litmusTestEnd}{
\vspace{.2cm}
\hrule
\vspace{.2cm}
}

\newcommand{\codePrefix}{
\begin{minipage}[t]{0.3\linewidth}
\vspace{-.2cm}
\begin{equation*}
\begin{tabular}{c}
}

\newcommand{\codePostfix}{
\end{tabular}
\end{equation*}
\end{minipage}
}

\newcommand{\sbTemplate}[6]{
  \codePrefix
  $\writeInstParam{#1}{x}{0}; \writeInstParam{#2}{y}{0};$ \\
\begin{tabular}{L || L}
  \writeInstParam{#3}{x}{1}; & \writeInstParam{#5}{y}{1}; \\
  \readInstParam{#4}{a}{y} & \readInstParam{#6}{b}{x} \\
\end{tabular}
  \codePostfix
}

\newcommand{\lbTemplate}[6]{
  \codePrefix
  $\writeInstParam{#1}{x}{0}; \writeInstParam{#2}{y}{0};$ \\
\begin{tabular}{L || L}
  \readInstParam{#3}{a}{y} & \readInstParam{#5}{b}{x} \\
  \writeInstParam{#4}{x}{1}; & \writeInstParam{#6}{y}{1}; \\
\end{tabular}
  \codePostfix
}

\newcommand{\mpTemplate}[6]{
  \codePrefix
  $\writeInstParam{#1}{f}{0}; \writeInstParam{#2}{d}{0};$ \\
\begin{tabular}{L || L}
  \writeInstParam{#3}{d}{5}  & \repeatReadInst{#5}{f} \\
  \writeInstParam{#4}{f}{1}; & \readInstParam{#6}{a}{d}; \\
\end{tabular}
  \codePostfix
}

\newcommand{\lbJoinTemplate}[4]{
  \codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
\begin{tabular}{L || L || L || L}
  \readInstParam{#1}{a}{y}; & \skipc & \readInstParam{#3}{b}{x}; & \skipc \\
  \writeInstParam{\rlx}{z1}{a} & & \writeInstParam{\rlx}{z2}{b} &  \\
  \multicolumn{2}{c ||}{$\writeInstParam{#2}{x}{1}$} &
  \multicolumn{2}{c}{$\writeInstParam{#4}{y}{1}$} \\
\end{tabular}
  \codePostfix
}

\newcommand{\iriwTemplate}[8]{
  \codePrefix
  $\writeInstParam{#1}{x}{0}; \writeInstParam{#2}{y}{0};$ \\
\begin{tabular}{L || L || L || L}
  \writeInstParam{#3}{x}{1} &
  \writeInstParam{#4}{y}{1} &
  \readInstParam{#5}{a}{x}; &
  \readInstParam{#7}{c}{y}; \\
  & &
  \readInstParam{#6}{b}{y} &
  \readInstParam{#8}{d}{x} \\
\end{tabular}
  \codePostfix
}

\newcommand{\wrTemplate}[8]{
\codePrefix
  $\writeInstParam{#1}{x}{0}; \writeInstParam{#2}{y}{0};$ \\
  \begin{tabular}{L || L}
    \writeInstParam{#3}{x}{1}; &
    \writeInstParam{#5}{y}{1}; \\

    \writeInstParam{#4}{y}{2} &
    \writeInstParam{#6}{x}{2} \\
  \end{tabular} \\
  $\readInstParam{#7}{a}{x};
   \readInstParam{#8}{b}{y}$
\codePostfix
}

\section{Store Buffering (SB)}
\label{app:sb}

\litmusTestStart{SB\_rel+acq}{\tick}{History + Viewfronts}
%
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\sbTemplate{\rel}{\rel}{\rel}{\acq}{\rel}{\acq}
\litmusTestEnd


\litmusTestStart{SB\_sc}{\tick}{SC + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Forbidden outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
\end{array}\]
\end{minipage}
%
\sbTemplate{\sco}{\sco}{\sco}{\sco}{\sco}{\sco}
\litmusTestEnd

\litmusTestStart{SB\_sc+rel}{\tick}{SC + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\sbTemplate{\sco}{\sco}{\rel}{\sco}{\sco}{\sco}
\litmusTestEnd

\litmusTestStart{SB\_sc+acq}{\tick}{SC + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\sbTemplate{\sco}{\sco}{\sco}{\acq}{\sco}{\sco}
\litmusTestEnd

%\newpage

\section{Load Buffering (LB)}
\label{app:lb}

\litmusTestStart{LB\_rlx}{\tick}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\lbTemplate{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}
\litmusTestEnd

\litmusTestStart{LB\_rel+rlx}{\tick}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\lbTemplate{\rlx}{\rlx}{\rlx}{\rel}{\rlx}{\rel}
\litmusTestEnd

\litmusTestStart{LB\_acq+rlx}{\fail}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0\\
a = 0 \land b = 1\\
a = 1 \land b = 0\\
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\lbTemplate{\rlx}{\rlx}{\acq}{\rlx}{\acq}{\rlx}

Our semantics doesn't allow the $a = 1 \land b = 1$ outcome for the program.
It doesn't allow reordering of an acquire read with a subsequent write.
The known sound compilation schemes of acquire read to major platforms (x86, ARM, Power) don't
allow the behavior either. 

\litmusTestEnd

\litmusTestStart{LB\_rel+acq+rlx}{\tick}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Forbidden outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\lbTemplate{\rlx}{\rlx}{\acq}{\rlx}{\rlx}{\rel}
\litmusTestEnd

\litmusTestStart{LB\_rlx+use}{\tick}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Allowed outcome:\\
\[\begin{array}{l}
a = 1 \land b = 1\\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
\begin{tabular}{L || L}
  \readInstParam{\rlx}{a}{y} & \readInstParam{\rlx}{b}{x} \\
  \writeInstParam{\rlx}{z1}{a}; & \writeInstParam{\rlx}{z2}{b}; \\
  \writeInstParam{\rlx}{x}{1}; & \writeInstParam{\rlx}{y}{1}; \\
\end{tabular}
\codePostfix

%% Comment:
%% Unfortunately, our semantics isn't able to reorder writes,
%% thus, we can't store 1s to z1 and z2.
\litmusTestEnd

\litmusTestStart{LB\_rlx+let}{\tick}{Postponed Reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Allowed outcome:\\
\[\begin{array}{l}
a = 1 \land a' = 2 \land b = 1 \land b' = 2 \\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
\begin{tabular}{L || L}
  \readInstParam{\rlx}{a}{y} & \readInstParam{\rlx}{b}{x} \\
  \assignInst{a'}{a + 1}; & \assignInst{b'}{b + 1}; \\
  \writeInstParam{\rlx}{x}{1}; & \writeInstParam{\rlx}{y}{1}; \\
\end{tabular}
\codePostfix

\litmusTestEnd

\litmusTestStart{LB\_rlx+join}{\tickPP}{Postponed Reads + History + Viewfronts + JN}
\begin{minipage}[t]{0.2\linewidth}
Allowed outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 1 \\
\end{array}\]
\end{minipage}
%
\lbJoinTemplate{\rlx}{\rlx}{\rlx}{\rlx}
%% Unfortunately, our semantics isn't complete for this snippet,
%% because it can't postpone write, or anything across a join point.
\litmusTestEnd

\litmusTestStart{LB\_rel+rlx+join}{\tickPP}{Postponed Reads + History + Viewfronts + JN}
\begin{minipage}[t]{0.2\linewidth}
Allowed outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 1 \\
\end{array}\]
\end{minipage}
%
\lbJoinTemplate{\rlx}{\rel}{\rlx}{\rel}
\litmusTestEnd

\litmusTestStart{LB\_acq+rlx+join}{\fail}{Postponed Reads + History + Viewfronts + JN}
\begin{minipage}[t]{0.2\linewidth}
Allowed outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 1 \\
\end{array}\]
\end{minipage}
%
\lbJoinTemplate{\acq}{\rlx}{\acq}{\rlx}
\litmusTestEnd

\section{Message Passing (MP)}
\label{app:mp}

\litmusTestStart{MP\_rlx+na}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \\
a = 5 \\
\kw{stuck} \\
\end{array}\]
\end{minipage}
%
\mpTemplate{\rlx}{\na}{\na}{\rlx}{\rlx}{\na}
\litmusTestEnd

\litmusTestStart{MP\_rel+rlx+na}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \\
a = 5 \\
\kw{stuck} \\
\end{array}\]
\end{minipage}
%
\mpTemplate{\rlx}{\na}{\na}{\rel}{\rlx}{\na}
\litmusTestEnd

\litmusTestStart{MP\_rlx+acq+na}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \\
a = 5 \\
\kw{stuck} \\
\end{array}\]
\end{minipage}
%
\mpTemplate{\rlx}{\na}{\na}{\rlx}{\acq}{\na}
\litmusTestEnd

\litmusTestStart{MP\_rel+acq+na}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 5 \\
\end{array}\]
\end{minipage}
%
\mpTemplate{\rlx}{\na}{\na}{\rel}{\acq}{\na}
\litmusTestEnd

\litmusTestStart{MP\_rel+acq+na+rlx}{\tick}{Write-fronts + NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 5 \\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rel}{f}{0}; \writeInstParam{\na}{d}{0};$ \\
  \begin{tabular}{L || L}
    \writeInstParam{\na}{d}{5}; & \repeatInst{[f]_{\acq} == 2}; \\
    \writeInstParam{\rel}{f}{1}; & \readInstParam{\na}{a}{d}\\
    \writeInstParam{\rlx}{f}{2}; & \\
  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{MP\_rel+acq+na+rlx\_2}{\tick}{Write-fronts + NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 5 \land b \in \{0, 1\} \\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\na}{f}{0}; \writeInstParam{\na}{d}{0}; \writeInstParam{\na}{x}{0};$ \\
  \begin{tabular}{L || L}
    \writeInstParam{\na}{d}{5};  & \repeatInst{[f]_{\acq} == 2}; \\
    \writeInstParam{\rel}{f}{1}; & \readInstParam{\na}{a}{d}\\
    \writeInstParam{\rel}{x}{1}; & \readInstParam{\rlx}{b}{x}\\
    \writeInstParam{\rlx}{f}{2}; & \\
  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{MP\_con+na}{\tick}{Consume + NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
b \in \{0, 5\} \\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{f}{\nullPtr}; \writeInstParam{\na}{d}{0};$ \\
  \begin{tabular}{L || L}
    \writeInstParam{\na}{d}{5};  & \readInstParam{\con}{a}{f}; \\
    \writeInstParam{\rel}{f}{d}; &
      \begin{array}{@{}l}
        \iteml{a \neq \nullPtr}
        {\readInstParam{\na}{b}{a}}
        {\assignInst{b}{0}} \\
      \end{array}
  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{MP\_con+na\_2}{\tick}{Consume + NA + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
b \in \{0, 5\} \land c \in \{0, 1\} \\
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\na}{p}{\nullPtr}; \writeInstParam{\na}{d}{0};
   \writeInstParam{\na}{x}{0};$ \\
  \begin{tabular}{L || L}
    \begin{array}{@{}l}
      \writeInstParam{\rlx}{x}{1}; \\
      \writeInstParam{\na}{d}{1}; \\
      \writeInstParam{\rel}{p}{d}; \\
    \end{array}
    &
    \begin{array}{@{}l}
     \readInstParam{\con}{a}{p}; \\
      \begin{array}{@{}l}
        \iteml{a \neq \nullPtr}
        {\readInstParam{\na}{b}{a}; \\
         \readInstParam{\rlx}{c}{x}}
        {\assignInst{b}{0}; \assignInst{c}{0}} \\
      \end{array}
    \end{array}

  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{MP\_cas+rel+acq+na from \cite{Vafeiadis-Narayan:OOPSLA13}}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.2\linewidth}
Impossible outcomes:\\
\[\begin{array}{l}
\kw{stuck}
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{f}{1}; \writeInstParam{\na}{d}{0};$ \\
  \begin{tabular}{L || L || L}
    \begin{array}{@{}l@{}}
      \writeInstParam{\na}{d}{5}; \\
      \writeInstParam{\rel}{f}{0}; \\
    \end{array}
    &
    \begin{array}{@{}l@{}}
      \casInstParam{\acq}{\rlx}{a}{f}{0}{1}; \\
      \iteml{a == 0}
      {\writeInstParam{\rlx}{d}{6}}
      {0}
    \end{array}
    &
    \begin{array}{@{}l@{}}
      \casInstParam{\acq}{\rlx}{b}{f}{0}{1}; \\
      \iteml{b == 0}
      {\writeInstParam{\rlx}{d}{7}}
      {0}
    \end{array}
  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{MP\_cas+rel+rlx+na}{\tick}{NA + History + Viewfronts}
\begin{minipage}[t]{0.2\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
\kw{stuck}
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{f}{1}; \writeInstParam{\na}{d}{0};$ \\
  \begin{tabular}{L || L || L}
    \begin{array}{@{}l@{}}
      \writeInstParam{\na}{d}{5}; \\
      \writeInstParam{\rel}{f}{0}; \\
    \end{array}
    &
    \begin{array}{@{}l@{}}
      \casInstParam{\rlx}{\rlx}{a}{f}{0}{1}; \\
      \iteml{a == 0}
      {\writeInstParam{\rlx}{d}{6}}
      {0}
    \end{array}
    &
    \begin{array}{@{}l@{}}
      \casInstParam{\rlx}{\rlx}{b}{f}{0}{1}; \\
      \iteml{b == 0}
      {\writeInstParam{\rlx}{d}{7}}
      {0}
    \end{array}
  \end{tabular}
\codePostfix
\litmusTestEnd

\section{Coherence of Read-Read (CoRR)}
\label{app:corr}

\litmusTestStart{CoRR\_rlx}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Impossible outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 2 \land c = 2 \land d = 1 \\
a = 1 \land b = 2 \land c = 2 \land d = 1 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0};$ \\
  \begin{tabular}{L || L || L || L}
    \begin{array}{@{}c@{}}
      \writeInstParam{\rlx}{x}{1}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \writeInstParam{\rlx}{x}{2}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \readInstParam{\rlx}{a}{x}; \\
      \readInstParam{\rlx}{b}{x}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \readInstParam{\rlx}{c}{x}; \\
      \readInstParam{\rlx}{d}{x}
    \end{array} 
  \end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{CoRR\_rel+acq}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Impossible outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 2 \land c = 2 \land d = 1 \\
a = 1 \land b = 2 \land c = 2 \land d = 1 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rel}{x}{0};$ \\
  \begin{tabular}{L || L || L || L}
    \begin{array}{@{}c@{}}
      \writeInstParam{\rel}{x}{1}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \writeInstParam{\rel}{x}{2}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \readInstParam{\acq}{a}{x}; \\
      \readInstParam{\acq}{b}{x}
    \end{array} & 
    \begin{array}{@{}c@{}}
      \readInstParam{\acq}{c}{x}; \\
      \readInstParam{\acq}{d}{x}
    \end{array} 
  \end{tabular}
\codePostfix
\litmusTestEnd

\section{Independent Reads of Independent Writes (IRIW)}
\label{app:iriw}

\litmusTestStart{IRIW\_rlx}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a \in \{0, 1\} \land b \in \{0, 1\} \land c \in \{0, 1\} \land d \in \{0, 1\} \\
\end{array}\]\\
\end{minipage}
%
\iriwTemplate{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}
%% Comment:
%% It is possible to get
%% \lstinline{r1 = 1; r2 = 0; r3 = 1; r4 = 0}
\litmusTestEnd

\litmusTestStart{IRIW\_rel+acq}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a \in \{0, 1\} \land b \in \{0, 1\} \land c \in \{0, 1\} \land d \in \{0, 1\} \\
\end{array}\]\\
\end{minipage}
%
\iriwTemplate{\rel}{\rel}{\rel}{\rel}{\acq}{\acq}{\acq}{\acq}
%% Comment:
%% It is possible to get
%% \lstinline{r1 = 1; r2 = 0; r3 = 1; r4 = 0}
\litmusTestEnd

\litmusTestStart{IRIW\_sc}{\tick}{SC + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Forbidden outcomes:\\
\[\begin{array}{l}
a = 1 \land b = 0 \land c = 1 \land d = 0 \\
\end{array}\]\\
\end{minipage}
%
\iriwTemplate{\sc}{\sc}{\sc}{\sc}{\sc}{\sc}{\sc}{\sc}
\litmusTestEnd

\section{Write-to-Read Causality (WRC)}
\label{app:wrc}

\litmusTestStart{WRC\_rel+acq}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Forbidden outcomes:\\
\[\begin{array}{l}
b = 1 \land c = 0 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rel}{x}{0}; \writeInstParam{\rel}{y}{1};$ \\
\begin{tabular}{L || L || L}
\writeInstParam{\rel}{x}{1} &
\readInstParam{\acq}{a}{x}; &
\readInstParam{\acq}{b}{y}; \\

&
\writeInstParam{\rel}{y}{a} &
\readInstParam{\acq}{c}{x} \\
\end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{WRC\_rlx}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
b \in \{0, 1\} \land c \in \{0, 1\} \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{1};$ \\
\begin{tabular}{L || L || L}
\writeInstParam{\rlx}{x}{1} &
\readInstParam{\rlx}{a}{x}; &
\readInstParam{\rlx}{b}{y}; \\

&
\writeInstParam{\rlx}{y}{a} &
\readInstParam{\rlx}{c}{x} \\
\end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{WRC\_cas+rel}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Impossible outcomes:\\
\[\begin{array}{l}
b = 2 \land c = 0 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rel}{x}{0}; \writeInstParam{\rel}{y}{1};$ \\
\begin{tabular}{L || L || L}
\writeInstParam{\rel}{x}{1}; &
\casInstParam{\rel}{\acq}{a}{y}{1}{2} &
\readInstParam{\acq}{b}{y}; \\

\writeInstParam{\rel}{y}{1} &
&
\readInstParam{\acq}{c}{x} \\
\end{tabular}
\codePostfix
\litmusTestEnd

\litmusTestStart{WRC\_cas+rlx}{\tick}{History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Impossible outcomes:\\
\[\begin{array}{l}
b = 2 \land c = 0 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
\begin{tabular}{L || L || L}
\writeInstParam{\rlx}{x}{1}; &
\casInstParam{\rlx}{\rlx}{a}{y}{1}{2} &
\readInstParam{\rlx}{b}{y}; \\

\writeInstParam{\rel}{y}{1} &
&
\readInstParam{\rlx}{c}{x} \\
\end{tabular}
\codePostfix
\litmusTestEnd

\section{Out-of-Thin-Air reads}
\label{app:ota}

In our semantics it is not possible to get out-of-thin-air results,
unlike the C11 standard. But such reads are considered to be an
undesirable behavior by most of the standard's
clients~\cite{Batty-al:ESOP15}.

\litmusTestStart{OTA\_lb}{\fail}{Postponed reads + History + Viewfronts}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
  \begin{tabular}{L || L}
    \readInstParam{\rlx}{a}{y}; &
    \readInstParam{\rlx}{b}{x} \\

    \writeInstParam{\rlx}{x}{a}; &
    \writeInstParam{\rlx}{y}{b} \\
  \end{tabular}
\codePostfix
%% Comment: According to the C11 standard \cite{C:11,CPP:11},
%% \lstinline{r1} and \lstinline{r2} can get arbitrary values.
\litmusTestEnd

\litmusTestStart{OTA\_if}{\fail}{Postponed reads + History + Viewfronts}
\begin{minipage}[t]{0.4\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
a = 0 \land b = 0 \\
\end{array}\]\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0}; \writeInstParam{\rlx}{y}{0};$ \\
  \begin{tabular}{L || L}
    \readInstParam{\rlx}{a}{y}; &
    \readInstParam{\rlx}{b}{x}; \\
    
    \begin{array}{@{}l@{}}
      \iteml{a}{\writeInstParam{\rlx}{x}{1}}{\assignInst{a}{0}}
    \end{array}
    &
    \begin{array}{@{}l@{}}
      \iteml{b}{\writeInstParam{\rlx}{y}{1}}{\assignInst{b}{0}}
    \end{array}
  \end{tabular}
\codePostfix
%% Comment: According to the C11 standard \cite{C:11,CPP:11},
%% \lstinline{r1} and \lstinline{r2} can be 1s at the end of execution.
\litmusTestEnd

\section{Write Reorder (WR), or 2+2W from \cite{Lahav-al:POPL16}}
\label{app:wr}

\litmusTestStart{WR\_rlx}{\tick}{History + Viewfronts + Operational Buffers}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  a = 1 \land b = 2 \\
  a = 2 \land b = 1 \\
  a = 2 \land b = 2 \\
\end{array}\]
\end{minipage}
%
\wrTemplate{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}{\rlx}
\litmusTestEnd

\litmusTestStart{WR\_rlx+rel}{\tick}{History + Viewfronts + Operational Buffers}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  a = 1 \land b = 2 \\
  a = 2 \land b = 1 \\
  a = 2 \land b = 2 \\
\end{array}\]
\end{minipage}
%
\wrTemplate{\rlx}{\rlx}{\rlx}{\rel}{\rlx}{\rel}{\rlx}{\rlx}
\litmusTestEnd

\litmusTestStart{WR\_rel}{\tick}{History + Viewfronts + Operational Buffers}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  a = 1 \land b = 2 \\
  a = 2 \land b = 1 \\
  a = 2 \land b = 2 \\
\end{array}\]
\end{minipage}
%
\wrTemplate{\rel}{\rel}{\rel}{\rel}{\rel}{\rel}{\acq}{\acq}
%% This is an example of the program from \cite{Lahav-al:POPL16}.
%% The weak behavior (\lstinline{r1 = r2 = 1}) is allowed in C11,
%% but never observable under any known sound compilation scheme
%% of the C11 release writes.
%% Our semantics doesn't allow such behaviour as well as SRA
%% \cite{Lahav-al:POPL16}. 
\litmusTestEnd

%% \section{Value Stealing}
%% \label{app:ss}

%% \litmusTestStart{VS\_rlx}{\tick}{}
%% \begin{minipage}[t]{0.3\linewidth}
%% Possible outcomes:\\
%% \lstinline{  r1 = 0}\\
%% \lstinline{  r1 = 1}\\
%% \end{minipage}
%% %
%% \begin{minipage}[t]{0.3\linewidth}
%% \vspace{-.2cm}
%%   \begin{tabular}{l@{\ \ \ }l}
%%     \begin{minipage}[l]{4.3cm} \small
%% \begin{lstlisting}
%%         |$[$|x|$]_{rlx}$| := 0; |$[$|y|$]_{rlx}$| := 0;
%% \end{lstlisting}
%% \vspace{-.2cm}
%% \begin{tabular}{l||l||l}
%% \begin{lstlisting}
%% r1 = |$[$|x|$]_{rlx}$|;
%% |$[$|x|$]_{rlx}$| := 1
%% \end{lstlisting}
%% \hspace{.6cm}
%% &
%% \begin{lstlisting}
%% r2 = |$[$|x|$]_{rlx}$|;
%% |$[$|y|$]_{rlx}$| := r2
%% \end{lstlisting}
%% \hspace{.6cm}
%% &
%% \begin{lstlisting}
%% r3 = |$[$|y|$]_{rlx}$|;
%% |$[$|x|$]_{rlx}$| := r3
%% \end{lstlisting}
%% \end{tabular}
%%     \end{minipage}
%% &
%%   \end{tabular}
%% \end{minipage}

%% \litmusTestEnd

\section{Speculative Execution}
\label{app:se}

\litmusTestStart{SE\_simple}{\tick}{}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  c \in \{0, 1\}
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0};
  \writeInstParam{\rlx}{y}{0};
  \writeInstParam{\rlx}{z}{0};$ \\
  \begin{tabular}{L || L}
    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{a}{x}; \\
      \iteml{a}{
        \writeInstParam{\rlx}{z}{1}; \\
        \writeInstParam{\rlx}{y}{1}
      }{\writeInstParam{\rlx}{y}{1}}
    \end{array} &

    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{b}{y}; \\
      \iteml{a}{
        \writeInstParam{\rlx}{x}{1}
      }{\skipc}
    \end{array}
  \end{tabular} \\
  $\readInstParam{\rlx}{c}{z}$
\codePostfix
\litmusTestEnd

\litmusTestStart{SE\_prop}{\tick}{}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  c \in \{0, 1\}
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0};
  \writeInstParam{\rlx}{y}{0};
  \writeInstParam{\rlx}{z}{0};$ \\
  \begin{tabular}{L || L}
    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{a}{x}; \\
      \iteml{a}{
        \writeInstParam{\rlx}{z}{1}; \\
        \readInstParam{\rlx}{a}{z}; \\
        \writeInstParam{\rlx}{y}{a}
      }{\writeInstParam{\rlx}{y}{1}}
    \end{array} &

    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{b}{y}; \\
      \iteml{a}{
        \writeInstParam{\rlx}{x}{1}
      }{\skipc}
    \end{array}
  \end{tabular} \\
  $\readInstParam{\rlx}{c}{z}$
\codePostfix
\litmusTestEnd

\litmusTestStart{SE\_nested}{\tick}{}
\begin{minipage}[t]{0.3\linewidth}
Possible outcomes:\\
\[\begin{array}{l}
  c \in \{0, 1\}
\end{array}\]
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rlx}{x}{0};
  \writeInstParam{\rlx}{y}{0};
  \writeInstParam{\rlx}{z}{0};
  \writeInstParam{\rlx}{f}{0};$ \\
  \begin{tabular}{L || L}
    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{a}{x}; \\
      \iteml{a}{
        \readInstParam{\rlx}{b}{f}; \\
        \iteml{b}{
          \writeInstParam{\rlx}{z}{1}; \\
          \writeInstParam{\rlx}{y}{1}
        }{\writeInstParam{\rlx}{y}{1}}
      }{\writeInstParam{\rlx}{y}{1}}
    \end{array} &

    \begin{array}{@{}l@{}}
      \readInstParam{\rlx}{b}{y}; \\
      \iteml{a}{
        \writeInstParam{\rlx}{f}{1}; \\
        \writeInstParam{\rlx}{x}{1}
      }{\skipc}
    \end{array}
  \end{tabular} \\
  $\readInstParam{\rlx}{c}{z}$
\codePostfix
\litmusTestEnd

\section{Locks}
\label{app:locks}

\begin{minipage}[t]{0.4\linewidth}
\textbf{Dekker's lock}\\\\
Possible outcomes:\\
\[\begin{array}{l}
  \Stuck
\end{array}\]
Requires: RA + na\\
Fully Supported: $\tick$\\
\end{minipage}
%
\codePrefix
$\writeInstParam{\rel}{x}{0}; \writeInstParam{\rel}{y}{0}; \writeInstParam{\na}{d}{0};$ \\
\begin{tabular}{L || L}
  \begin{array}{@{}l@{}}
    \writeInstParam{\rel}{x}{1}; \\
    \readInstParam{\acq}{a}{y}; \\
    \iteml{a == 0}{
      \writeInstParam{\na}{d}{5}
    }{\skipc}
  \end{array} &
  \begin{array}{@{}l@{}}
    \writeInstParam{\rel}{y}{1}; \\
    \readInstParam{\acq}{b}{x}; \\
    \iteml{b == 0}{
      \writeInstParam{\na}{d}{6}
    }{\skipc}
  \end{array}
\end{tabular}
\codePostfix
\litmusTestEnd

\begin{minipage}[t]{0.4\linewidth}
\textbf{Cohen's lock}\\\\
Impossible outcomes (according to \cite{Turon-al:OOPSLA14}):\\
\[\begin{array}{l}
  \Stuck
\end{array}\]
Requires: RA + na\\
Fully Supported: $\tick$\\
\end{minipage}
%
\codePrefix
  $\writeInstParam{\rel}{x}{0};\writeInstParam{\rel}{y}{0};\writeInstParam{\na}{d}{0};$ \\
  \begin{tabular}{L || L}
    \begin{array}{@{}l@{}}
      \writeInstParam{\rel}{x}{\Choice{1}{2}}; \\
      \repeatReadInst{\acq}{y}; \\
      \readInstParam{\acq}{a}{x}; \\
      \readInstParam{\acq}{b}{y}; \\
      \iteml{a == b}{
        \writeInstParam{\na}{d}{5}
      }{\skipc}
    \end{array} &

    \begin{array}{@{}l@{}}
      \writeInstParam{\rel}{y}{\Choice{1}{2}}; \\
      \repeatReadInst{\acq}{x}; \\
      \readInstParam{\acq}{c}{x}; \\
      \readInstParam{\acq}{d}{y}; \\
      \iteml{c \neq d}{
        \writeInstParam{\na}{d}{6}
      }{\skipc}
    \end{array}
  \end{tabular}
\codePostfix
\litmusTestEnd
%% \end{figure*}
